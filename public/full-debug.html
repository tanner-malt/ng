<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idle: Dynasty Builder - FULL DEBUG</title>
    <link rel="stylesheet" href="game.css">
    <link rel="stylesheet" href="progress-icons.css">
    <style>
        .debug-overlay {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100vh;
            background: rgba(0,0,0,0.95);
            color: white;
            font-family: monospace;
            font-size: 11px;
            padding: 10px;
            overflow-y: auto;
            z-index: 99999;
            border-left: 2px solid #0f0;
        }
        .terrain-highlight {
            border: 3px solid red !important;
            box-shadow: 0 0 10px red !important;
        }
        .debug-section {
            margin-bottom: 15px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Full Debug Overlay -->
    <div class="debug-overlay" id="debug-overlay">
        <h3>üîç FULL DEBUG</h3>
        <div id="debug-sections"></div>
        <button onclick="highlightTerrain()" style="margin: 5px 0;">Highlight Terrain</button>
        <button onclick="refreshDebug()" style="margin: 5px 0;">Refresh</button>
        <button onclick="inspectFirstTile()" style="margin: 5px 0;">Inspect First Tile</button>
    </div>

    <!-- Top Right Icons -->
    <div id="top-right-icons">
        <button id="sound-btn" class="icon-btn" title="Sound">
            <span>üîä</span>
        </button>
        <button id="tutorial-btn" class="icon-btn" title="Tutorial & Help">
            <span>üìö</span>
        </button>
        <button id="quest-btn" class="icon-btn" title="Expeditions & Quests">
            <span>üó∫Ô∏è</span>
        </button>
        <button id="settings-btn" class="icon-btn" title="Settings">
            <span>‚öôÔ∏è</span>
        </button>
        <button id="progress-btn" class="icon-btn progress-incomplete" title="Progression">
            <span id="progress-icon">üèÜ</span>
        </button>
    </div>

    <!-- Game Container -->
    <div id="game-container">
        <nav id="view-navigation">
            <button class="nav-btn active" data-view="village" id="village-tab">Village</button>
            <button class="nav-btn" data-view="battle" id="battle-tab">Battle</button>
            <button class="nav-btn" data-view="monarch" id="monarch-tab">Monarch (LOCKED)</button>
            <button class="nav-btn" data-view="throne" id="throne-tab">Throne</button>
        </nav>
        
        <main id="game-content">
            <!-- Village View -->
            <div id="village-view" class="game-view active">
                <div class="village-header">
                    <h2>Village Management</h2>
                    <div class="resource-panel">
                        <span>Food: <span id="food-count">100</span></span>
                        <span>Wood: <span id="wood-count">50</span></span>
                        <span>Stone: <span id="stone-count">25</span></span>
                        <span>Population: <span id="population-count">10</span></span>
                        <span>Season: <span id="season-count">Spring</span></span>
                    </div>
                </div>
                
                <div class="village-content">
                    <div id="village-grid" class="village-grid"></div>
                    
                    <div class="village-sidebar">
                        <div class="village-info">
                            <h3>Buildings</h3>
                            <div class="building-list">
                                <button class="building-btn" data-building="house" title="Cost: 10 Wood">
                                    House (10 Wood)
                                </button>
                                <button class="building-btn" data-building="farm" title="Cost: 15 Wood, 5 Stone">
                                    Farm (15 Wood, 5 Stone)
                                </button>
                                <button class="building-btn" data-building="townCenter" title="Cost: 30 Wood, 25 Stone">
                                    Town Center (30 Wood, 25 Stone)
                                </button>
                                <button class="building-btn" data-building="barracks" title="Cost: 30 Wood, 20 Stone">
                                    Barracks (30 Wood, 20 Stone)
                                </button>
                            </div>
                            
                            <div class="village-stats">
                                <h3>Village Stats</h3>
                                <p>Buildings: <span id="building-count">0</span></p>
                                <p>Happiness: <span id="happiness">100%</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="../src/gameState.js"></script>
    <script src="../src/modalSystem.js"></script>
    <script src="../src/village.js"></script>
    <script src="../src/battle.js"></script>
    <script src="../src/throne.js"></script>
    <script src="../src/monarch.js"></script>
    <script src="../src/quest.js"></script>
    <script src="../src/quests.js"></script>
    <script src="../src/tutorial.js"></script>
    <script src="../src/uiPopups.js"></script>
    <script src="../src/app.js"></script>
    
    <script>
        let debugLog = [];
        
        function log(message) {
            console.log(message);
            debugLog.push(new Date().toISOString().split('T')[1].split('.')[0] + ': ' + message);
            if (debugLog.length > 50) debugLog.shift();
        }
        
        // Override console.log to capture everything
        const originalLog = console.log;
        console.log = function(...args) {
            debugLog.push(new Date().toISOString().split('T')[1].split('.')[0] + ': ' + args.join(' '));
            if (debugLog.length > 50) debugLog.shift();
            originalLog.apply(console, args);
        };
        
        function refreshDebug() {
            const debugSections = document.getElementById('debug-sections');
            const villageGrid = document.getElementById('village-grid');
            const villageView = document.getElementById('village-view');
            const gameContainer = document.getElementById('game-container');
            
            const terrainTiles = villageGrid.querySelectorAll('.terrain-tile');
            const buildings = villageGrid.querySelectorAll('.building');
            
            const villageGridStyle = window.getComputedStyle(villageGrid);
            const villageViewStyle = window.getComputedStyle(villageView);
            const gameContainerStyle = window.getComputedStyle(gameContainer);
            
            // Get first terrain tile for detailed inspection
            const firstTile = terrainTiles[0];
            let firstTileInfo = 'No terrain tiles found';
            if (firstTile) {
                const firstTileStyle = window.getComputedStyle(firstTile);
                firstTileInfo = `
                    Position: ${firstTile.style.position || 'not set'}
                    Left: ${firstTile.style.left || 'not set'}
                    Top: ${firstTile.style.top || 'not set'}
                    Width: ${firstTile.style.width || 'not set'}
                    Height: ${firstTile.style.height || 'not set'}
                    Background: ${firstTile.style.backgroundColor || 'not set'}
                    Z-index: ${firstTile.style.zIndex || 'not set'}
                    Display: ${firstTileStyle.display}
                    Visibility: ${firstTileStyle.visibility}
                    Opacity: ${firstTileStyle.opacity}
                    Content: "${firstTile.textContent}"
                `;
            }
            
            const sections = [
                {
                    title: 'Game State',
                    content: `
                        Game Instance: ${window._gameInstance ? '‚úÖ' : '‚ùå'}
                        window.game: ${window.game ? '‚úÖ' : '‚ùå'}
                        Village Manager: ${window.game?.villageManager ? '‚úÖ' : '‚ùå'}
                        Current View: ${window.game?.currentView || 'unknown'}
                    `
                },
                {
                    title: 'DOM Structure',
                    content: `
                        Game Container:
                        - Display: ${gameContainerStyle.display}
                        - Height: ${gameContainerStyle.height}
                        - Width: ${gameContainerStyle.width}
                        
                        Village View:
                        - Display: ${villageViewStyle.display}
                        - Classes: ${villageView.className}
                        - Width: ${villageViewStyle.width}
                        - Height: ${villageViewStyle.height}
                        
                        Village Grid:
                        - Display: ${villageGridStyle.display}
                        - Position: ${villageGridStyle.position}
                        - Min-height: ${villageGridStyle.minHeight}
                        - Width: ${villageGridStyle.width}
                        - Height: ${villageGridStyle.height}
                        - Background: ${villageGridStyle.backgroundColor}
                    `
                },
                {
                    title: 'Content Analysis',
                    content: `
                        Terrain Tiles: ${terrainTiles.length}
                        Buildings: ${buildings.length}
                        Grid HTML Length: ${villageGrid.innerHTML.length}
                        Grid Children: ${villageGrid.children.length}
                        
                        First Terrain Tile:
                        ${firstTileInfo}
                    `
                },
                {
                    title: 'Recent Console Log',
                    content: debugLog.slice(-10).join('<br>')
                }
            ];
            
            debugSections.innerHTML = sections.map(section => `
                <div class="debug-section">
                    <strong>${section.title}:</strong>
                    <pre style="white-space: pre-wrap; font-size: 10px;">${section.content}</pre>
                </div>
            `).join('');
        }
        
        function highlightTerrain() {
            const terrainTiles = document.querySelectorAll('.terrain-tile');
            terrainTiles.forEach(tile => {
                tile.classList.toggle('terrain-highlight');
            });
            log(`Toggled highlight on ${terrainTiles.length} terrain tiles`);
        }
        
        function inspectFirstTile() {
            const firstTile = document.querySelector('.terrain-tile');
            if (firstTile) {
                log('First tile found, checking visibility...');
                const rect = firstTile.getBoundingClientRect();
                log(`First tile rect: ${rect.left}, ${rect.top}, ${rect.width}, ${rect.height}`);
                log(`Viewport: ${window.innerWidth}x${window.innerHeight}`);
                log(`Is in viewport: ${rect.left >= 0 && rect.top >= 0 && rect.left < window.innerWidth && rect.top < window.innerHeight}`);
            } else {
                log('No terrain tiles found to inspect');
            }
        }
        
        // Initial debug after a delay
        setTimeout(refreshDebug, 500);
        setTimeout(refreshDebug, 2000);
        setTimeout(refreshDebug, 5000);
        
        // Auto-refresh debug
        setInterval(refreshDebug, 5000);
        
        log('Full debug system initialized');
    </script>
</body>
</html>
