<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Tutorial Test</title>
    <link rel="stylesheet" href="public/game.css">
    
    <style>
        body { background: #2c3e50; color: white; padding: 20px; }
        .test-btn { 
            background: #3498db; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            margin: 10px; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        .log { 
            background: #34495e; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            max-height: 400px; 
            overflow-y: auto; 
        }
    </style>
</head>
<body>
    <h1>🔬 Minimal Tutorial Test</h1>
    
    <button class="test-btn" onclick="testBasics()">1. Test Basic Loading</button>
    <button class="test-btn" onclick="testModal()">2. Test Modal System</button>
    <button class="test-btn" onclick="testTutorialCreation()">3. Test Tutorial Creation</button>
    <button class="test-btn" onclick="testTutorialStart()">4. Start Tutorial</button>
    <button class="test-btn" onclick="clearLog()">Clear Log</button>
    
    <div id="log" class="log"></div>

    <!-- Load scripts in order -->
    <script src="src/eventBus.js"></script>
    <script src="src/gameState.js"></script>
    <script src="src/modalSystem.js"></script>
    <script src="src/uiPopups.js"></script>
    <script src="src/tutorial.js"></script>

    <script>
        let tutorialInstance = null;
        let modalInstance = null;
        let eventBusInstance = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#e74c3c' : type === 'success' ? '#2ecc71' : type === 'warning' ? '#f39c12' : '#ecf0f1';
            
            logDiv.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function testBasics() {
            log('=== Testing Basic Loading ===', 'info');
            
            // Check classes
            log(`EventBus: ${!!window.EventBus}`, window.EventBus ? 'success' : 'error');
            log(`ModalSystem: ${!!window.ModalSystem}`, window.ModalSystem ? 'success' : 'error');
            log(`TutorialManager: ${!!window.TutorialManager}`, window.TutorialManager ? 'success' : 'error');
            log(`showModal function: ${!!window.showModal}`, window.showModal ? 'success' : 'error');
            
            // Initialize EventBus
            if (window.EventBus) {
                try {
                    eventBusInstance = new window.EventBus();
                    window.eventBus = eventBusInstance;
                    log('✅ EventBus initialized', 'success');
                } catch (error) {
                    log(`❌ EventBus error: ${error.message}`, 'error');
                }
            }
        }

        function testModal() {
            log('=== Testing Modal System ===', 'info');
            
            if (window.ModalSystem) {
                try {
                    modalInstance = new window.ModalSystem();
                    log('✅ ModalSystem created', 'success');
                    
                    if (window.showModal) {
                        window.showModal('Test Modal', 'This is a test modal to verify functionality.', {
                            icon: '🧪',
                            type: 'info'
                        }).then(() => {
                            log('✅ Modal displayed and closed successfully', 'success');
                        }).catch(error => {
                            log(`❌ Modal promise error: ${error.message}`, 'error');
                        });
                    } else {
                        log('❌ showModal function not available after ModalSystem init', 'error');
                    }
                } catch (error) {
                    log(`❌ Modal creation error: ${error.message}`, 'error');
                }
            } else {
                log('❌ ModalSystem class not available', 'error');
            }
        }

        function testTutorialCreation() {
            log('=== Testing Tutorial Creation ===', 'info');
            
            if (window.TutorialManager) {
                try {
                    tutorialInstance = new window.TutorialManager();
                    log('✅ TutorialManager created', 'success');
                    log(`Tutorial steps: ${tutorialInstance.steps?.length || 0}`, 'info');
                    log(`Dynasty name: ${tutorialInstance.getDynastyName()}`, 'info');
                    log(`showIntro method: ${!!tutorialInstance.showIntro}`, tutorialInstance.showIntro ? 'success' : 'error');
                    
                    if (tutorialInstance.steps && tutorialInstance.steps.length > 0) {
                        log(`First step: ${tutorialInstance.steps[0].id} - ${tutorialInstance.steps[0].title}`, 'info');
                    }
                } catch (error) {
                    log(`❌ Tutorial creation error: ${error.message}`, 'error');
                    console.error('Tutorial creation error:', error);
                }
            } else {
                log('❌ TutorialManager class not available', 'error');
            }
        }

        function testTutorialStart() {
            log('=== Testing Tutorial Start ===', 'info');
            
            if (!tutorialInstance) {
                log('❌ No tutorial instance - run test 3 first', 'error');
                return;
            }
            
            if (!window.showModal) {
                log('❌ showModal not available - run test 2 first', 'error');
                return;
            }
            
            try {
                log('🚀 Starting tutorial...', 'info');
                tutorialInstance.showIntro();
                log('✅ Tutorial showIntro called', 'success');
            } catch (error) {
                log(`❌ Tutorial start error: ${error.message}`, 'error');
                console.error('Tutorial start error:', error);
            }
        }

        // Auto-run basic test
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                testBasics();
            }, 500);
        });
    </script>
</body>
</html>
