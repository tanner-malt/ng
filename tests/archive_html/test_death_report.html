<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Death Report Test</title>
    <link rel="stylesheet" href="public/game.css">
</head>
<body>
    <!-- Load all necessary scripts -->
    <script src="src/systems/core/eventBus.js"></script>
    <script src="src/gameData.js"></script>
    <script src="src/populationManager.js"></script>
    <script src="src/gameState.js"></script>
    <script src="src/modalSystem.js"></script>

    <!-- Simple test container -->
    <div style="padding: 20px; color: white;">
        <h1>Death Report Functionality Test</h1>
        <button id="test-death-report" style="padding: 10px 20px; font-size: 16px;">Test Death Report</button>
        <div id="test-results" style="margin-top: 20px;"></div>
    </div>

    <script>
        // Wait for everything to load
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                console.log('Testing death report functionality...');
                
                // Initialize game state
                const gameState = new GameState();
                
                // Create some test population with various ages
                if (gameState.populationManager) {
                    console.log('Adding test population...');
                    
                    // Add some villagers at various ages
                    const testAges = [160, 170, 180, 190, 195, 197, 197, 30, 45, 60, 120];
                    testAges.forEach((age, index) => {
                        gameState.populationManager.addInhabitant({
                            name: `Test Villager ${index + 1}`,
                            age: age,
                            gender: index % 2 === 0 ? 'male' : 'female',
                            role: 'peasant',
                            status: 'idle'
                        });
                    });
                    
                    console.log('Test population added. Total population:', gameState.populationManager.getAll().length);
                    
                    // Test the death report calculation
                    const dailyReport = gameState.getDeathReportData('daily');
                    const monthlyReport = gameState.getDeathReportData('monthly');
                    
                    console.log('Daily death report:', dailyReport);
                    console.log('Monthly death report:', monthlyReport);
                    
                    document.getElementById('test-results').innerHTML = `
                        <h3>Test Results:</h3>
                        <p><strong>Total Population:</strong> ${dailyReport.totalPopulation}</p>
                        <p><strong>Daily Expected Deaths:</strong> ${dailyReport.expectedDeaths}</p>
                        <p><strong>Monthly Expected Deaths:</strong> ${monthlyReport.expectedDeaths}</p>
                        <p><strong>Imminent Deaths (197+ days):</strong> ${dailyReport.imminentDeaths}</p>
                        <p><strong>Total At Risk (160+ days):</strong> ${dailyReport.totalAtRisk}</p>
                        <h4>Age Groups:</h4>
                        ${Object.values(dailyReport.ageGroups).map(group => 
                            `<p>${group.name}: ${group.count} villagers</p>`
                        ).join('')}
                    `;
                } else {
                    document.getElementById('test-results').innerHTML = '<p style="color: red;">Error: PopulationManager not available</p>';
                }
                
                // Set up test button
                document.getElementById('test-death-report').addEventListener('click', () => {
                    console.log('Testing death report modal...');
                    if (window.modalSystem && gameState) {
                        window.modalSystem.showDeathReportModal(gameState, 'daily');
                    } else {
                        alert('Modal system not available');
                    }
                });
                
            }, 1000);
        });
    </script>
</body>
</html>
